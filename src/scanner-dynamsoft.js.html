// Dynamsoft license (your working v90 license)
<script>
Dynamsoft.DBR.BarcodeScanner.license =
  "DLS2eyJoYW5kc2hha2VDb2RlIjoiMTA0MzY1MTU3LU1UQTBNelkxTVRVM0xYZGxZaTFVY21saGJGQnliMm8iLCJtYWluU2VydmVyVVJMIjoiaHR0cHM6Ly9tZGxzLmR5bmFtc29mdG9ubGluZS5jb20iLCJvcmdhbml6YXRpb25JRCI6IjEwNDM2NTE1NyIsInN0YW5kYnlTZXJ2ZXJVUkwiOiJodHRwczovL3NkbHMuZHluYW1zb2Z0b25saW5lLmNvbSIsImNoZWNrQ29kZSI6MTI5Nzc5NDc4OH0=";

/**
 * Open a simple camera UI, capture a frame, decode with Dynamsoft, return text.
 * Resolves with the barcode text or null (on cancel / failure).
 */
async function openDynamsoftScanner(containerEl) {
  containerEl.innerHTML = `
    <div class="camera card">
      <video id="barcodeVideo" autoplay playsinline></video>
      <div class="actions" style="margin-top:.5rem">
        <button id="capturePhotoBtn" class="btn">ðŸ“¸ Capture</button>
        <button id="cancelScanBtn" class="btn ghost">Cancel</button>
      </div>
      <canvas id="barcodeCanvas" style="display:none"></canvas>
    </div>`;

  const video   = containerEl.querySelector('#barcodeVideo');
  const capture = containerEl.querySelector('#capturePhotoBtn');
  const cancel  = containerEl.querySelector('#cancelScanBtn');
  const canvas  = containerEl.querySelector('#barcodeCanvas');

  // Start camera
  let stream = null;
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
    video.srcObject = stream;
    await new Promise(res => { video.onloadedmetadata = () => { video.play?.(); res(); }; });
  } catch (err) {
    console.error('Camera error:', err);
    throw new Error('Camera access denied or unavailable.');
  }

  // Lazy instance
  let instance = null;
  async function getScanner() {
    if (!instance) instance = await Dynamsoft.DBR.BarcodeScanner.createInstance();
    return instance;
  }

  return new Promise((resolve) => {
    cancel.onclick = () => {
      try { stream?.getTracks().forEach(t => t.stop()); } catch(_) {}
      containerEl.innerHTML = '';
      resolve(null);
    };

    capture.onclick = async () => {
      // Freeze frame
      canvas.width = video.videoWidth; canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      try { stream?.getTracks().forEach(t => t.stop()); } catch(_) {}

      const dataURL = canvas.toDataURL('image/png');
      try {
        const scanner = await getScanner();
        const results = await scanner.decode(dataURL);
        const text = results?.[0]?.barcodeText || '';
        containerEl.innerHTML = '';
        resolve(text || null);
      } catch (e) {
        console.error('Dynamsoft decode error:', e);
        containerEl.innerHTML = '';
        resolve(null);
      }
    };
  });
}
</script>